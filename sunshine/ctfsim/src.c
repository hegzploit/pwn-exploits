_UNKNOWN main;
__int64 (*funcs_1769)() = &sub_1340;         // weak
__int64(__fastcall *off_3D28)() = &sub_1300; // weak
void *off_4008 = &off_4008;                  // idb
_UNKNOWN unk_4010;                           // weak
char byte_4020;                              // weak
char s[1008];                                // idb
char dest[24];                               // idb

char *read_1000_into_s() {
  char *v1; // [rsp+8h] [rbp-8h]

  if (!fgets(s, 1000, stdin))
    return 0LL;
  // first occurance of newline
  // v1 == ptr to \n
  // nullterminates
  v1 = strchr(s, 10);
  if (v1)
    *v1 = 0;
  return s;
}

__int64 __fastcall main(int a1, char **a2, char **a3) {
  int v4;               // [rsp+8h] [rbp-98h] BYREF
  int i;                // [rsp+Ch] [rbp-94h]
  int fd;               // [rsp+10h] [rbp-90h]
  int v7;               // [rsp+14h] [rbp-8Ch]
  char *src;            // [rsp+18h] [rbp-88h]
  FILE *stream;         // [rsp+20h] [rbp-80h]
  char *v10;            // [rsp+28h] [rbp-78h]
  char s[104];          // [rsp+30h] [rbp-70h] BYREF
  unsigned __int64 v12; // [rsp+98h] [rbp-8h]

  v12 = __readfsqword(0x28u);
  fd = open("/dev/urandom", 0, a3);
  if (fd < 0 || read(fd, &dest[20], 4uLL) != 4) {
    puts("Fatal error!");
    exit(1);
  }
  close(fd);
  srand(*(_DWORD *)&dest[20]);
  puts("||| CTF Simulator 2022 |||");
  puts("This CTF training simulator will hone your guessing skills so you can "
       "be more competitive in CTF competitions!");
  printf("What's the name of your CTF team?\n[>] ");
  fflush(stdout);
  src = read_1000_into_s();
  if (!src) {
    puts("Invalid team name!");
    exit(1);
  }
  strncpy(dest, src, 0x14uLL);
  for (i = 10; i <= 999999999; i *= 10) {
    printf(
        "Okay %s, I'm thinking of a number between 1 and %d. What is it?\n[>] ",
        dest, (unsigned int)i);
    fflush(stdout);
    v7 = rand() % i + 1;
    v4 = 0;
    src = read_1000_into_s();
    if ((unsigned int)__isoc99_sscanf(src, "%d", &v4) != 1) {
      puts("Bad guess!");
      exit(1);
    }
    if (v7 > v4) {
      puts("Too low!");
      exit(1);
    }
    if (v7 < v4) {
      puts("Too high!");
      exit(1);
    }
    puts("That's it!");
  }
  puts("Wow, did you hack into my brain? Great guessing! You'll be a CTF star "
       "in no time!");
  stream = fopen("flag.txt", "r");
  if (!stream) {
    puts("Flag file is missing!");
    exit(1);
  }
  if (!fgets(s, 100, stream)) {
    puts("Error reading from flag file!");
    exit(1);
  }
  fclose(stream);
  v10 = strchr(s, 10);
  if (v10)
    *v10 = 0;
  printf("Here's a reward for you: %s\n", s);
  return 0LL;
}
// 1200: using guessed type __int64 __isoc99_sscanf(_QWORD, const char *, ...);

//----- (00000000000016C9) ----------------------------------------------------
int sub_16C9() {
  setvbuf(stdout, 0LL, 2, 0LL);
  return setvbuf(stderr, 0LL, 2, 0LL);
}

//----- (0000000000001720) ----------------------------------------------------
void init(void) {
  signed __int64 v0; // rbp
  __int64 i;         // rbx

  init_proc();
  v0 = &off_3D28 - &funcs_1769;
  if (v0) {
    for (i = 0LL; i != v0; ++i)
      (*(&funcs_1769 + i))();
  }
}
